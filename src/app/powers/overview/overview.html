<div ba-panel>
    <div class="overview">

        <div id="container" style="height: 700px"></div>

        <script type="text/javascript">

            var mapObj;
            var mapLabData;

            var scope = angular.element($("#container")).scope();
            mapLabData = scope.show;
            if (mapLabData) {

                function mapInit() {
                    mapObj = new AMap.Map('container', {
//                    dragEnable: false,      //是否可拖拽
//                    zoomEnable: false,      //是否可缩放
                        zoom: 12,
                        center: [121.493496, 31.224609],    // 定义地图中心点
//                    mapStyle: 'fresh',
//                    features: ['road', 'building','bg']
                    });
                    AMap.event.addListener(mapObj, "complete", completeEventHandler);
                }

                mapInit();

                function completeEventHandler() {

                    for (x in mapLabData) {
                        var item = mapLabData[x];
                        var content =
                                "<div style='text-align: center;'>" +
                                "<div>" +
                                "<img src='" + item.ico + "' style='width: 50px;height: 50px;'/>" +
                                "<div style='color: #fff;background: #000;opacity:0.5;padding: 3px 5px;font-size: 12px;white-space:nowrap;border-radius:5px !important'>" + item.name + "</div>" +
                                "</div>" +
                                "</div>";

                        var marker = new AMap.Marker({
                            position: new AMap.LngLat(item.longitude, item.latitude),
                            content: content,
                            extData: item.cid
                        });

                        // map events
                        var _onmouseover = function (e) {
                            openWindow(e);
                        };
                        AMap.event.addListener(marker, 'mouseover', _onmouseover);
//                    var _mouseout = function (e) {
//                        mapObj.clearInfoWindow();
//                    };
//                    AMap.event.addListener(marker, 'mouseout', _mouseout);

                        marker.setMap(mapObj);  // add point
                    }
                }

                function openWindow(e) {

                    var cid = e.target.getExtData();
                    var pos = e.target.getPosition();

                    scope.getDetail(cid, pos, showPop);
                }

                function showPop(item, pos) {

                    var percentage = parseInt(item.currentmd) / parseInt(item.requiredmd) * 100 + "%";

                    var custXml = "<div class='map-content'>" +
                            "<div class='map-btn-title'>" + item.name + "</div>" +
                            "<div class='map-item'>电压等级：" + item.level +
                            "</div>" +
                            "<div class='map-item'>站内规定人数：" + item.numofppl +
                            "</div>" +
                            "<div class='map-item'>具体地址：" + item.address +
                            "</div>" +
                            "<div class='map-item'>站长：" + item.contactor +
                            "</div>" +
                            "<div class='map-item'>站长手机：" + item.contactortel +
                            "</div>" +
                            "<div class='map-item'>站内电话：" + item.phonenumber +
                            "</div>" +
                            "<div class='map-item'>用户联系人：" + item.customer_contactor +
                            "</div>" +
                            "<div class='map-item'>用户联系电话：" + item.customer_contactortel +
                            "</div>" +
                            "<div class='map-item'>建筑面积：" + item.structurearea +
                            "</div>" +
                            "<div class='map-item'>安全运行天数：" + item.safeRunningDays +
                            "</div>" +
                            "<div class='map-item'>当前负荷：" + item.currentmd +
                            "</div>" +
                            "<div class='map-item'>当月申报需量：" + item.requiredmd +
                            "</div>" +
                            "<div style='height: 5px;background: #dcdcdc;margin: 5px 0;'>" +
                            "<div style='display: inline-block;background: #1baeb3;height: 5px;float: left;width:" + percentage + ";'></div>" +
                            "</div>" +
                            "<div style='line-height: 25px;padding: 0 10px;text-align: center;color: #1baeb3'>" + percentage +
                            "</div>" +
                            "<a href='/#/monitoring?id=" + item.cid + "' class='map-btn-monitoring'>" +
                            "前往该站" +
                            "</a>" +
                            "<a href='/#/events?id=" + item.cid + "' class='map-btn-event'>" +
                            "查看该站事件" +
                            "</a>" +
                            "</div>";

                    var infoWindow = new AMap.InfoWindow({
                        isCustom: true,
                        closeWhenClickMap: true,
                        offset: new AMap.Pixel(200, -50),
                        content: custXml
                    });
                    infoWindow.open(mapObj, pos);
                }
            } else {
                console.log('mapLabData不存在...');
            }

        </script>

    </div>
</div>
